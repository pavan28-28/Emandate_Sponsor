

<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">

<meta http-equiv="X-UA-Compatible" content="IE=edge;IE=11">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>E-nach</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" th:href="@{/bootstrap.min.css}" />
  <link rel="stylesheet" th:href="@{/main.css}" />
  
  <link rel="stylesheet" th:href="@{/font-awesome.min.css}">
  
   <!-- new version  -->
  <script th:src="@{/jquery-3.5.1.min.js}"></script>

  <script th:src="@{/popper.min.js}"></script>

  <script th:src="@{/bootstrap.min.js}"></script>
  
  <script th:src="@{/main.js}"></script>
 
  <link rel="stylesheet" th:href="@{/datepicker.css}" type="text/css" />
  
  <script th:src="@{/bootstrap-datepicker.js}"></script>
  
  <script th:src="@{/aes.js}" type="text/javascript"></script>
  
  <script th:src="@{/pbkdf2.js}"></script>
 
  
<script>
function validateLoanNo(loanNumber){
	var flag=false;
	var proregex= 'HLREGEX';
	var regex ="";
	if(proregex.trim()== 'HLREGEX'){
		regex = /^([a-zA-Z]){5}([0-9]){11}?$/;
	}else if(proregex.trim() == 'ALPHANUMERIC'){
		regex = /^[0-9a-zA-Z]+$/;
	}else if(proregex.trim() == 'NUMERIC'){
		regex = /^[0-9-+()]*$/;
	}
	var loanErrMsg = 'Please enter your loan account number';
	var maxlength = '16';
	
	console.log("Expression from properties = "+regex);
	var loanNumber = $('#loanAcNo').val();
	if( loanNumber == ""){
		$("#lano_errormsg").html(loanErrMsg);
        $("#lano_errormsg").show();
        $(".loanno").addClass("error_input");
	}  else if(!regex.test(loanNumber)) {
    	$("#lano_errormsg").html(loanErrMsg);
    	$("#lano_errormsg").show();
    	$(".loanno").addClass("error_input");
    }else if(maxlength!='NA' && loanNumber.length > maxlength) {
    	$("#lano_errormsg").html("Field max length is "+maxlength+" only");
    	$("#lano_errormsg").show();
    	$(".loanno").addClass("error_input");
    }else{
    	$("#lano_errormsg").hide();
    	$(".loanno").removeClass("error_input");
    	flag=true;
    }
	return flag;
}
function validateBankName(){
	var bankName = $("#bankName").val();
	var flag=false;
	if(bankName == 'Select Bank' || bankName == ''){
		console.log("select bank......");
		$("#bn_errMsg").show();
		$(".bankName").addClass("error_input");
	}else{
		$("#bn_errMsg").hide();
		flag=true;
	}
	return flag;
}

function validateFreqName(){
	//alert("method");
	var freqName = $("#freqName").val();
	var flag=false;
	if(freqName == 'Select Frequency' || freqName == ''){
		console.log("select Frequency......");
		$("#freq_errMsg").show();
		$(".freqName").addClass("error_input");
	}else{
		$("#freq_errMsg").hide();
		flag=true;
	}
	return flag;
}

function validateTypeName(){
	//alert("method");
	var typeName = $("#typeName").val();
	var flag=false;
	if(typeName == 'Select Type' || typeName == ''){
		console.log("select Collection Type......");
		$("#type_errMsg").show();
		$(".typeName").addClass("error_input");
	}else{
		$("#type_errMsg").hide();
		flag=true;
	}
	return flag;
}

function validateAccType(){
	var payType = $("#acccountType").val();
	var flag=false;
	if(payType == 'Select Account Type' || payType == ''){
		console.log("select Account Type......");
		$("#accType_errMsg").show();
		$(".accountType").addClass("error_input");
	}else{
		$("#accType_errMsg").hide();
		flag=true;
	}
	return flag;
}

function validatePayType(){
	var payType = $("#paymentType").val();
	var flag=false;
	if(payType == 'Select Payment Type' || payType == ''){
		console.log("select Payment Type......");
		$("#payType_errMsg").show();
		$(".paymentType").addClass("error_input");
	}else{
		$("#payType_errMsg").hide();
		flag=true;
	}
	return flag;
}



function validateMaxEmiAmount(){
	var maxEmiAmount	=	$('#maximumEmiAmount').val();
	var emiAmount		=	parseInt($("#emiAmount").val());
	var parseMaxEmiAmount	=	parseInt($("#maximumEmiAmount").val());
	
	var maxCollectionAmountRegex	= 'NUMERIC';
	//var maxCollectionAmountMaximum	= '1000000';
	var regex;
	if(maxCollectionAmountRegex.trim() == 'NUMERIC'){
		regex = /^[0-9-+()]*$/;
	}else if(maxCollectionAmountRegex.trim() == 'DECIMAL'){
		regex = /^[0-9]+([.][0-9]{2})?$/g;
	}
	var flag=false;
	
	//increased amount changes
	var paymentType = $("#paymentType").val();
	var maxCollectionAmountMaximum= '1000000';
	console.log("Selected payment Type is :"+paymentType);
	if(paymentType=='Debit Card'){
		maxCollectionAmountMaximum	= '10000000';
	}else if(paymentType=='Net Banking'){
		maxCollectionAmountMaximum	= '10000000';
	}else if(paymentType=='Aadhaar number'){
		maxCollectionAmountMaximum	= '10000000';
	}
	console.log("maxCollectionAmountMaximum :"+maxCollectionAmountMaximum);
	//ends
	
	if( maxEmiAmount == ""){
		$("#mamt_errMsg").html("Please enter maximum collection amount.");
        $("#mamt_errMsg").show();
        $(".maxEmiAmt").addClass("error_input");
	}
	else if(!regex.test(maxEmiAmount)){
    	$("#mamt_errMsg").html("Maximum collection amount should be numeric.");
    	$("#mamt_errMsg").show();
    	$(".maxEmiAmt").addClass("error_input");
    }
	else if(maxEmiAmount > parseInt(maxCollectionAmountMaximum)){
	   //	$("#mamt_errMsg").html("e Mandate can be created for less than or equal Rs. 100000");
	   	//$("#mamt_errMsg").show();
	   	//$(".maxEmiAmt").addClass("error_input");
	   	//alert("e Mandate can be created for less than or equal Rs. 1000000");
	   	alert("e Mandate can be created for less than or equal Rs. "+maxCollectionAmountMaximum);
	}
	else if(emiAmount > parseMaxEmiAmount){
	   	//$("#mamt_errMsg").html("Maximum collection amount should be greater than collection amount.");
	   	//$("#mamt_errMsg").show();
	   	//$(".maxEmiAmt").addClass("error_input");
	   	alert("Maximum collection amount should be greater than collection amount.");
	}else{
    	$("#mamt_errMsg").hide();
    	$(".maxEmiAmt").removeClass("error_input");
    	flag=true;
    }
	return flag;
}

function validateName(){
	var name = $('#name').val();
	var alphabateswithspace=/^[a-zA-Z\s]+$/;
	var flag=false;
	if( name == ""){
		$("#name_errMsg").html("Please enter your full name.");
        $("#name_errMsg").show();
        $(".name").addClass("error_input");
	} else if(name.length > 50){
    	$("#name_errMsg").html("Full name allows maximum 50 characters only.");
    	$("#name_errMsg").show();
    	$(".name").addClass("error_input");
    } else if(!alphabateswithspace.test(name)) {
    	$("#name_errMsg").html("Full name allows alpabates and space only.");
    	$("#name_errMsg").show();
    	$(".name").addClass("error_input");
    } else{
    	$("#name_errMsg").hide();
    	$(".name").removeClass("error_input");
    	flag=true;
    }
	return flag;
}

function validateEmailId(){
	var emailId = $('#emailId').val();
	var emailValidation = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
	var flag=false;
	if(!emailValidation.test(emailId))
    {
    	$("#email_errMsg").html("Please enter a valid emailId.");
    	$("#email_errMsg").show();
    	$(".email").addClass("error_input");
    }else{
    	$("#email_errMsg").html("Please enter your emailId.");
    	$("#email_errMsg").hide();
    	$(".email").removeClass("error_input");
    	flag=true;
    }
	return flag;
}

function validateMobileNumber(){
	var mobileNumber = $('#mobileNumber').val();
	var numsonly=/^[0-9-+()]*$/;
	var flag=false;
	if(mobileNumber == ""){
		$("#mobile_errMsg").html("Please enter your mobile number.");
		$("#mobile_errMsg").show();
		$(".mobile").addClass("error_input");
	}
	else if(mobileNumber.length < 10)
	{
		$("#mobile_errMsg").html("Please enter a valid 10 digit mobile number.");
		$("#mobile_errMsg").show();
		$(".mobile").addClass("error_input");
	}
	else if(!numsonly.test(mobileNumber))
    {
    	$("#mobile_errMsg").html("Mobile number shoud be numeric.");
    	$("#mobile_errMsg").show();
    	$(".mobile").addClass("error_input");
    }
	else
	{
		$("#mobile_errMsg").hide();
		$(".mobile").removeClass("error_input");
		flag=true;
	}
	return flag;
}

function validateLoanAmount(){
	
	var loanAmount = $('#loanAmount').val();
	var numsonly=/^[0-9-+()]*$/;
	var flag=false;
	if(loanAmount == ""){
		$("#la_errMsg").html("Please enter your loan amount.");
		$("#la_errMsg").show();
		$(".loanAmount").addClass("error_input");
	}else if(!numsonly.test(loanAmount))
    {
    	$("#la_errMsg").html("Loan Amount number shoud be numeric.");
    	$("#la_errMsg").show();
    	$(".loanAmount").addClass("error_input");
    }
	else
	{
		$("#la_errMsg").hide();
		$(".loanAmount").removeClass("error_input");
		flag=true;
	}
	return flag;
}
function validateAccountNO(){
	var accountNumber = $('#accountNumber').val();
	var numsonly=/^[0-9-+()]*$/;
	var flag=false;
	
	if(accountNumber == ""){
		$("#ac_errMsg").html("Please enter your debit account number.");
		$("#ac_errMsg").show();
		$(".debitAc").addClass("error_input");
	}else if(!numsonly.test(accountNumber))  {
    	$("#ac_errMsg").html("Account number shoud be numeric.");
    	$("#ac_errMsg").show();
    	$(".debitAc").addClass("error_input");
    } else {
		$("#ac_errMsg").hide();
		$(".debitAc").removeClass("error_input");
		flag=true;
	}
	return flag;
}

function validateConfirmACNO(){
	var confirmAccountNumber = $("#confirmAccountNumber").val();
	var numsonly=/^[0-9-+()]*$/;
	var flag=false;
	if(confirmAccountNumber == ""){
		$("#cac_errMsg").html("Please enter your confirm account number.");
		$("#cac_errMsg").show();
		$(".confirmAc").addClass("error_input");
	}else if(!numsonly.test(confirmAccountNumber)) {
    	$("#cac_errMsg").html("Confirm account number shoud be numeric.");
    	$("#cac_errMsg").show();
    	$(".confirmAc").addClass("error_input");
    } else if(confirmAccountNumber != $("#accountNumber").val()){
    	//$("#cac_errMsg").html("Debit account number and confirm account number shoud be same.");
    	//$("#cac_errMsg").show();
    	//$(".confirmAc").addClass("error_input");
    	alert("Debit account number and confirm account number shoud be same.");
    	$("#confirmAccountNumber").focus();
    } else {
		$("#cac_errMsg").hide();
		$(".confirmAc").removeClass("error_input");
		flag=true;
	}
	return flag;
	
}
function validateIfscCode(){
	var ifscCode = $('#ifscCode').val();
	var numswithalphabate=/^[0-9a-zA-Z]+$/;
	var flag=false;
	if( ifscCode == ""){
		$("#ifsc_errMsg").html("Please enter your ifsc code");
        $("#ifsc_errMsg").show();
        $(".ifsc").addClass("error_input");
	}else if(ifscCode.length < 11){
    	$("#ifsc_errMsg").html("Please enter a valid 11 digit ifsc code.");
    	$("#ifsc_errMsg").show();
    	$(".ifsc").addClass("error_input");
    }else if(!numswithalphabate.test(ifscCode))
    {
    	$("#ifsc_errMsg").html("Ifsc code allows alpabates and numbers only.");
    	$("#ifsc_errMsg").show();
    	$(".ifsc").addClass("error_input");
    }else{
    	$("#ifsc_errMsg").hide();
    	$(".ifsc").removeClass("error_input");
    	flag=true;
    }
	return flag;
}

function validateEmiAmount(){
	var emiAmount = $('#emiAmount').val();
	var collectionAmountRegex	= 'NUMERIC';
	/* var collectionAmountMaximum	= '1000000';
	collectionAmountMaximum	=	parseInt(collectionAmountMaximum); */
	var regex;
	if(collectionAmountRegex.trim() == 'NUMERIC'){
		regex = /^[0-9-+()]*$/;
	}else if(collectionAmountRegex.trim() == 'DECIMAL'){
		regex = /^[0-9]+([.][0-9]{2})?$/g;
	}
	var flag=false;
	
	//increased amount changes
	var paymentType = $("#paymentType").val();
	var collectionAmountMaximum= '1000000';
	console.log("Selected payment Type is :"+paymentType);
	if(paymentType=='Debit Card'){
		collectionAmountMaximum	= '10000000';
	}else if(paymentType=='Net Banking'){
		collectionAmountMaximum	= '10000000';
	}else if(paymentType=='Aadhaar number'){
		collectionAmountMaximum	= '10000000';
	}
	console.log("collectionAmountMaximum :"+collectionAmountMaximum);
	//ends
	
	if( emiAmount == ""){
		$("#eamt_errMsg").html("Please enter collection amount.");
        $("#eamt_errMsg").show();
        $(".emiAmt").addClass("error_input");
	}else if(!regex.test(emiAmount)) {
    	$("#eamt_errMsg").html("Collection amount should be numeric.");
    	$("#eamt_errMsg").show();
    	$(".emiAmt").addClass("error_input");
    }else if(emiAmount > parseInt(collectionAmountMaximum)){
		$("#eamt_errMsg").html("e Mandate can be created for less than or equal Rs. "+collectionAmountMaximum);
    	$("#eamt_errMsg").show();
    	$(".emiAmt").addClass("error_input");
    }else{
    	$("#eamt_errMsg").hide();
    	$(".emiAmt").removeClass("error_input");
    	flag=true;
    }
	return flag;
}

function validateEmiStartDate(){
	var emiStartdate = $("#datepicker_first").val();
	var flag=false;
	if(emiStartdate == ""){
		$("#emiStart_errMsg").show();
		$(".emiStart").addClass("error_input");
	}else{
		var date =$("#datepicker_first").val().split("-");
		var startDate= new Date(date[2], date[1] - 1, date[0]);
		var edate=$("#datepicker_last").val().split("-");
		if(edate != ""){
			var endDate= new Date(edate[2], edate[1] - 1, edate[0]);
			if(endDate <= startDate){
				//$("#emiStart_errMsg").html("Collection last date should greater than Collection first date.");
				//$("#emiStart_errMsg").show();
				alert("Collection last date should greater than Collection first date.");
			}else{
				$("#emiStart_errMsg").hide();
				$(".emiStart").removeClass("error_input");
				flag=true;
			}
		}else{
			$("#emiStart_errMsg").hide();
			$(".emiStart").removeClass("error_input");
			flag=true;
			
		}
		
	}
	return flag;
}

function validateEmiEndDate(){
	var emiEndDate = $("#datepicker_last").val();
	var flag=false;
	if(emiEndDate == ""){
		$("#emiend_errMsg").show();
		$(".emiEnd").addClass("error_input");
	}else{
		var date =$("#datepicker_first").val().split("-");
		var startDate= new Date(date[2], date[1] - 1, date[0]);
		var edate=$("#datepicker_last").val().split("-");
		if(edate != ""){
			var endDate= new Date(edate[2], edate[1] - 1, edate[0]);
			if(endDate <= startDate){
				 //$("#emiend_errMsg").html("Collectoin start Date must be earlier than collection end date.");
					//$("#emiend_errMsg").show(); 
					alert("Collection start Date must be earlier than collection end date.");
			}else{
				$("#emiStart_errMsg").hide();
				$(".emiStart").removeClass("error_input");
				$("#emiend_errMsg").hide();
				$(".emiEnd").removeClass("error_input");
				flag=true;
			}
		}else{
			$("#emiend_errMsg").hide();
			$(".emiEnd").removeClass("error_input");
			flag=true;
		}
		
	}
	return flag;
}



function setBankName(bankName,bankCode){
	console.log("setBankName called");
	 $('.bank-select label button').text(bankName);
	 $("#bankName").val(bankCode);
     $("#bn_errMsg").hide();
}

function setPaymentType(paymentKey,paymentValue){
	console.log("setPaymentType called");
	 $('.payment-select label button').text(paymentValue);
	 $("#paymentType").val(paymentKey);
    $("#payType_errMsg").hide();
}

function setAccountType(accountKey,accountValue){
	console.log("setAccountType called");
	 $('.accountType-select label button').text(accountValue);
	 $("#acccountType").val(accountKey);
    $("#accType_errMsg").hide();
}

function setFreqName(freqName,freqCode){
	//alert("called");
	$('.freq-select label button').text(freqName);
	$("#freqName").val(freqCode);
    $("#freq_errMsg").hide();
}

function setTypeName(typeName,typeCode){
	//alert("called");
	$('.type-select label button').text(typeName);
	$("#typeName").val(typeCode);
    $("#type_errMsg").hide();
}

function dropdownList(id){
	var paymentType = $("#paymentType").val();
	var myIDHid;
	console.log("Selected payment Type is :"+paymentType);
	if(paymentType=='' || paymentType=='Net Banking'){
		myIDHid    =    $('#hidBname').val();
	}else if (paymentType=='Debit Card'){
		myIDHid    =    $('#hideDebitBankName').val();
	}else {
		myIDHid    =    $('#hideAadharBankName').val();
	}
	var myIDSize    =    myIDHid.split(",");
    var myIDMap    =    [];
    if(myIDSize.length==1){
        item    =    myIDSize[0].replace("{","").trim();   
        item    =    item.replace("}","").trim();
        myIDMap.push(item);
    }else{
        for(var i = 0; i < myIDSize.length ; i++) {
            var item;
            if(i==0)          
                item=myIDSize[i].replace("{","").trim();          
            else if(i==myIDSize.length-1)          
                item=myIDSize[i].replace("}","").trim();          
            else          
                item=myIDSize[i].trim();

            myIDMap.push(item);
        }
    }
    return myIDMap;
}

function dropdownPaymentList(id){
	var myIDHid    =    $('#hidePaymentType').val();
	var myIDSize    =    myIDHid.split(",");
    var myIDMap    =    [];
    if(myIDSize.length==1){
        item    =    myIDSize[0].replace("{","").trim();   
        item    =    item.replace("}","").trim();
        myIDMap.push(item);
    }else{
        for(var i = 0; i < myIDSize.length ; i++) {
            var item;
            if(i==0)          
                item=myIDSize[i].replace("{","").trim();          
            else if(i==myIDSize.length-1)          
                item=myIDSize[i].replace("}","").trim();          
            else          
                item=myIDSize[i].trim();

            myIDMap.push(item);
        }
    }
    return myIDMap;
}

function dropdownAccountList(id){
	var myIDHid    =    $('#hideAccountType').val();
	var myIDSize    =    myIDHid.split(",");
    var myIDMap    =    [];
    if(myIDSize.length==1){
        item    =    myIDSize[0].replace("{","").trim();   
        item    =    item.replace("}","").trim();
        myIDMap.push(item);
    }else{
        for(var i = 0; i < myIDSize.length ; i++) {
            var item;
            if(i==0)          
                item=myIDSize[i].replace("{","").trim();          
            else if(i==myIDSize.length-1)          
                item=myIDSize[i].replace("}","").trim();          
            else          
                item=myIDSize[i].trim();

            myIDMap.push(item);
        }
    }
    return myIDMap;
}
  

function dropdownListForFreq(id){
	//alert("called");
	var myIDHid    =    $('#hidFname').val();
	var myIDSize    =    myIDHid.split(",");
    var myIDMap    =    [];
    if(myIDSize.length==1){
        item    =    myIDSize[0].replace("{","").trim();   
        item    =    item.replace("}","").trim();
        myIDMap.push(item);
    }else{
        for(var i = 0; i < myIDSize.length ; i++) {
            var item;
            if(i==0)          
                item=myIDSize[i].replace("{","").trim();          
            else if(i==myIDSize.length-1)          
                item=myIDSize[i].replace("}","").trim();          
            else          
                item=myIDSize[i].trim();

            myIDMap.push(item);
        }
    }
    return myIDMap;
}

function dropdownListForType(id){
	//alert("called");
	var myIDHid    =    $('#hidTname').val();
	var myIDSize    =    myIDHid.split(",");
    var myIDMap    =    [];
    if(myIDSize.length==1){
        item    =    myIDSize[0].replace("{","").trim();   
        item    =    item.replace("}","").trim();
        myIDMap.push(item);
    }else{
        for(var i = 0; i < myIDSize.length ; i++) {
            var item;
            if(i==0)          
                item=myIDSize[i].replace("{","").trim();          
            else if(i==myIDSize.length-1)          
                item=myIDSize[i].replace("}","").trim();          
            else          
                item=myIDSize[i].trim();

            myIDMap.push(item);
        }
    }
    return myIDMap;
}
$(document).ready(function(){
	var finoneErr		=	'';
	var startDate 		=	'';
	var endDate			=	'';
	var bankName		=	'';
	var freqName		=	'';
	var typeName		=	'';
	var bankCode		=	'';
	var freqCode		=	'';
	var typeCode		=	'';
	var paymentTypeCode	=	'';
	var accountTypeCode	=	'';
	$("#aId").text('Loan Account Number');
	if(bankCode==''){
		bankCode		=	'';
	}
	if(freqCode==''){
		freqCode		=	'';
	}
	if(typeCode==''){
		typeCode		=	'';
	}
	if(paymentTypeCode==''){
		paymentTypeCode	=	'';
	}
	if(accountTypeCode==''){
		accountTypeCode	=	'';
	}
	var enachProductCode		 =	'';
	var enachEmailId			 =	'';
	var enachBankId				 =	'';
	//Bank name have to display
	var enachAccountNumber		 = 	'';
	var enachConfirmAccountNumber= 	'';
	var enachAcccountType		 = 	'';
	var enachIfscCode			 =	'';
	var enachEmiAmount			 =	'';
	var enachMaximumEmiAmount	 =	'';
	var enachEmiType			 =	'';
	var enachEmiFrequency		 =	'';
	var enachEmiStartDate		 =	'';
	var enachEmiEndDate			 =	'';
	var bankFlag 				 = '';
	var enachPaymentType		 =	'';
	var enachAccountType		 =	'';
	console.log("freqName:"+freqName+" enachEmiFrequency:"+enachEmiFrequency+" enachPaymentType"+enachPaymentType);
	
	var salt 					=	CryptoJS.lib.WordArray.random(128 / 8);
	var iv 						=	CryptoJS.lib.WordArray.random(128 / 8); 
	var encryptionKey 			=	'66466939';
	var key128Bits 				=	 CryptoJS.PBKDF2(encryptionKey, salt,  {keySize : 128 / 32});
	var key128Bits100Iterations = CryptoJS.PBKDF2(encryptionKey,salt, {keySize : 128 / 32,iterations : 100 });
	document.getElementById("vid").value	=	iv;
	document.getElementById("salt_id").value=	salt;
	function getEncryptValue( input){
		var output = CryptoJS.AES.encrypt(input,key128Bits100Iterations,{iv : iv,mode : CryptoJS.mode.CBC,padding : CryptoJS.pad.Pkcs7}); 
		return output;
	}

	$(document).on('click','.md-whiteframe-z1 li',function(e){
		console.log("md-whiteframe-z1");
		setBankName($(this).text(),$(this).attr("data-value"));
	});

	$(document).on('click','.md-whiteframe-z9 li',function(e){
		console.log("md-whiteframe-z9");
		setPaymentType($(this).text(),$(this).attr("data-value"));
	});
	
	$(document).on('click','.md-whiteframe-z12 li',function(e){
		console.log("md-whiteframe-z12");
		setAccountType($(this).text(),$(this).attr("data-value"));
	});

	$(document).on('click','.md-whiteframe-z2 li',function(e){
		//alert("cal");
	    setFreqName($(this).text(),$(this).attr("data-value"));
	});

	$(document).on('click','.md-whiteframe-z3 li',function(e){
		//alert("cal");
	    setTypeName($(this).text(),$(this).attr("data-value"));
	});

	$('#confirmAccountNumber').on("cut copy paste",function(e) {
	    e.preventDefault();
	 });
	if(bankCode!=''){
		setBankName(bankName,bankCode);
	}
	if(paymentTypeCode!=''){
		setPaymentType(enachPaymentType,paymentTypeCode);
	}
	if(accountTypeCode!=''){
		setAccountType(enachAccountType,accountTypeCode);
	}
	console.log("freqName:"+freqName+" freqCode:"+freqCode);
	console.log("typeName:"+typeName+" typeCode:"+typeCode);
	console.log("enachPaymentType:"+enachPaymentType+" paymentTypeCode:"+paymentTypeCode);
	console.log("enachAccountType:"+enachAccountType+" accountTypeCode:"+accountTypeCode);
	if(typeCode!=''){
		setTypeName(typeName,typeCode);
	}
	console.log("enachProductCode :"+enachProductCode);
	if(freqCode!=''){
		setFreqName(freqName,freqCode);
	}else if(enachProductCode !="RF"){
		setFreqName('Monthly','MNTH');
		$('#ul-id5').hide();
		setTypeName('Variable Amount','M');
		$('#ul-id6').hide();
	}

	if(finoneErr == 'true'){	
	    var response='';
		if(response=='001'){
			$("#errorMessage1").show();
		}else {
			$("#errorMessage").show();	
		}
	     
		var year=endDate.split("-")[2];
		var month=endDate.split("-")[1]-1;
		var day=endDate.split("-")[0];
		console.log(year+"::"+month+" :: "+day);
		
		var date =new Date(year,month,day);
		console.log("date = "+date);
		date.setDate(date.getDate());
		$('#datepicker_last').datepicker("setStartDate", date);
	}
	
	$(".form-group").removeClass("error_input");
	var numswithalphabate=/^[0-9a-zA-Z]+$/;
	var alphabateswithspace=/^[a-zA-Z\s]+$/;
	var emailValidation = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
	var numsonly=/^[0-9-+()]*$/;
	$(".error_msg").hide();	

	$('#loanAcNo').keyup(function(){
		validateLoanNo();
	});
	$('#name').keyup(function(){
		validateName();
	}); 
	$('#emailId').keyup(function(){
		validateEmailId();
	}); 
	$('#mobileNumber').keyup(function(){
		validateMobileNumber();
	}); 

	$("#bankBtn").click(function(){
		  var me = $(this),
	      items = [],
	      myID = me.attr('id'),
	      arr = dropdownList(myID);
	      myParent = me.closest('.form-group');
	      $.each(arr, function(i, item) {
	          var ddValues=item.split("=");
	          items.push('<li role="option" class="ng-binding ng-scope" tabindex="-1" aria-selected="false" data-value="'+ddValues[0]+'">' + ddValues[1] + '</li>');
	      }); 
	      myParent.find('#ul-id4').empty().html(items.join(''));
	      //$("#ul-id4").removeAttr("style");
	});
	 $("#paymentBtn").click(function(){
		 //alert(bankFlag);
		 if(!bankFlag){
			 $("#bankBtn").text("Select Bank");//here we are refreshing the bank name dropdowns every time
			  var me = $(this),
		      items = [],
		      myID = me.attr('id'),
		      arr = dropdownPaymentList(myID);
		      myParent = me.closest('.form-group'); 
		       $.each(arr, function(i, item) {
		       var ddValues=item.split("=");
		        items.push('<li role="payment" class="ng-binding ng-scope" tabindex="-1" aria-selected="false" data-value="'+ddValues[0]+'">' + ddValues[1] + '</li>');
		      });   
		      myParent.find('#ul-id41').empty().html(items.join(''));    
		 }
	});  
	 $("#accountTypeBtn").click(function(){
		  var me = $(this),
	     items = [],
	     myID = me.attr('id'),
	     arr = dropdownAccountList(myID);
	     myParent = me.closest('.form-group'); 
	      $.each(arr, function(i, item) {
	      var ddValues=item.split("=");
	       items.push('<li role="option" class="ng-binding ng-scope" tabindex="-1" aria-selected="false" data-value="'+ddValues[0]+'">' + ddValues[1] + '</li>');
	     });   
	     myParent.find('#ul-id3').empty().html(items.join(''));    
	});
	$("#freqBtn").click(function(){
		//validateBankName();
		  var me = $(this),
	      items = [],
	      myID = me.attr('id'),
	      arr = dropdownListForFreq(myID);
	      myParent = me.closest('.form-group');
	      $.each(arr, function(i, item) {
	          var ddValues=item.split("=");
	          items.push('<li role="option" class="ng-binding ng-scope" tabindex="-1" aria-selected="false" data-value="'+ddValues[0]+'">' + ddValues[1] + '</li>');
	      });
	      myParent.find('#ul-id5').empty().html(items.join(''));
	});

	$("#typeBtn").click(function(){
		//validateBankName();
		  var me = $(this),
	      items = [],
	      myID = me.attr('id'),
	      arr = dropdownListForType(myID);
	      myParent = me.closest('.form-group');
	      $.each(arr, function(i, item) {
	          var ddValues=item.split("=");
	          items.push('<li role="option" class="ng-binding ng-scope" tabindex="-1" aria-selected="false" data-value="'+ddValues[0]+'">' + ddValues[1] + '</li>');
	      });
	      myParent.find('#ul-id6').empty().html(items.join(''));
	});
	$('#loanAmount').keyup(function(){
		validateLoanAmount();
	});


	$('#accountNumber').keyup(function(){	
		validateAccountNO();
	});
	$('#ifscCode').keyup(function(){
		validateIfscCode();
	});
	$('#emiAmount').keyup(function(){
		validateEmiAmount();
	});
	$("#submitMandate").click(function(){
		document.getElementById("productCode").value='HL';
		var productCode 			=	'HL';
		var loanNumber 				=	$('#loanAcNo').val();
		var name 					=	$('#name').val();
		var emailId 				=	$('#emailId').val();
		var mobileNumber 			=	$('#mobileNumber').val();
		var loanAmount 				=	$('#loanAmount').val();
		var accountNumber 			=	$('#accountNumber').val();
		var confirmAccountNumber 	=	$("#confirmAccountNumber").val();
		var ifscCode 				=	$('#ifscCode').val();
		var emiAmount 				=	$('#emiAmount').val();
		var maxEmiAmount 			=	$('#maximumEmiAmount').val();
		var emiStartDate 			=	$("#datepicker_first").val();
		var emiEndDate 				= 	$("#datepicker_last").val();
		var paymentType 			= 	$("#paymentType").val();
		var bankName 				= 	$("#bankName").val();
		var emiFrequency			=	$("#freqName").val();
		var emiType					=	$("#typeName").val();
		var acType					=	$("#acccountType").val();
		
		$("#emiFrequency").val(emiFrequency);
		$("#emiType").val(emiType);
		//var emiType=$('input[name=emiType]:checked').val();
		//var emiFrequency=$('input[name=emiFrequency]:checked').val();
		var bankFlag = '';
		if(bankFlag){
			if(enachEmiEndDate != ""){
				 emiEndDate = $("#emiEndDate").val();
				 $("#emiEndDate").attr("id","datepicker_last");
			}
			if(enachEmiStartDate != ""){
				emiStartDate=$("#emiStartDate").val();
				$("#emiStartDate").attr("id","datepicker_first");
			}
		}
		if(productCode=='RF'){
			loanAmount=' ';
		}	
		
		var qs=loanNumber+"&"+name+"&"+emailId+"&"+mobileNumber+"&"+loanAmount+"&"+accountNumber+"&"+confirmAccountNumber+"&"+
			   ifscCode+"&"+emiAmount+"&"+maxEmiAmount+"&"+emiStartDate+"&"+emiEndDate+"&"+bankName+"&"+acType+"&"+emiType+"&"+emiFrequency+"&"+paymentType;
		console.log("Data before encryption :: "+qs);
		var encqs=CryptoJS.AES.encrypt(qs,key128Bits100Iterations,{iv : iv,mode : CryptoJS.mode.CBC,padding : CryptoJS.pad.Pkcs7});
		document.getElementById("qs").value=encqs;
		 console.log("loanNumber = "+loanNumber+", name = "+name+", emailId = "+emailId+", mobileNumber = "+mobileNumber
				+", accountNumber = "+accountNumber+", confirmAccountNumber = "+confirmAccountNumber+", ifscCode = "+ifscCode
				+", emiAmount = "+emiAmount+", maxEmiAmount = "+maxEmiAmount+", emiStartDate =  "+emiStartDate+", emiEndDate, "+emiEndDate+"bank Name ="+bankname); 
		
		var loanAcFlag		=	validateLoanNo();
		var nameFlag		=	validateName();
		var emailIdFlag		=	validateEmailId();
		var mobileFlag		=	validateMobileNumber();
		var acFlag			=	validateAccountNO();
		var cacFlag			=	validateConfirmACNO();
		var ifscFlag		=	validateIfscCode();
		var emiAmtFlag		=	validateEmiAmount();
		var maxEmiAmtFlag	=	validateMaxEmiAmount();
		var bankNameFlag	=	validateBankName();
		var emiStartFlag	=	validateEmiStartDate();
		var emiEndFlag		=	false;
		if(emiStartFlag){
			emiEndFlag	=	validateEmiEndDate();
		}
		var termsFlag		=	validateTerms();
		var freqNameFlag	=	validateFreqName();
		var typeNameFlag	=	validateTypeName();
		var payTypeFlag 	= 	validatePayType();
		var accTypeFlag 	=	validateAccType();
		var amtFlag;
		if(productCode=='RF'){
			amtFlag	=	true;
		}else{
			amtFlag=validateLoanAmount();
		}
		
		if(loanAcFlag && nameFlag && emailIdFlag && mobileFlag && amtFlag && acFlag && cacFlag && ifscFlag && emiAmtFlag && maxEmiAmtFlag 
				&& bankNameFlag && emiStartFlag && emiEndFlag && termsFlag && freqNameFlag && typeNameFlag && payTypeFlag && accTypeFlag){
			$("#lano_errormsg").hide();
	    	$(".loanno").removeClass("error_input");
	    	$("#name_errMsg").hide();
	    	$(".name").removeClass("error_input");
	    	$("#email_errMsg").hide();
	    	$(".email").removeClass("error_input");
	    	$("#mobile_errMsg").hide();
			$(".mobile").removeClass("error_input");
			$("#ac_errMsg").hide();
			$(".debitAc").removeClass("error_input");
			$("#cac_errMsg").hide();
			$(".confirmAc").removeClass("error_input");
			$("#ifsc_errMsg").hide();
	    	$(".ifsc").removeClass("error_input");
	    	$("#eamt_errMsg").hide();
	    	$(".emiAmt").removeClass("error_input");
	    	$("#mamt_errMsg").hide();
	    	$(".maxEmiAmt").removeClass("error_input");
	    	$("#emiStart_errMsg").hide();
	    	$("#emiend_errMsg").hide();
	    	$("#bn_errMsg").hide();
	    	$("#terms_errMsg").hide();
	    	$("#emiStart_errMsg").hide();
	    	$("#emiend_errMsg").hide();
	    	$("#accType_errMsg").hide();
	    	
	    	var isSubmit=confirm("Do you want Authorize Mandate?");
	    	if(isSubmit){
		    	document.enachForm.action="submitNpciEnachForm.htm";
		    	document.enachForm.submit();
	    	}
		}else{
	    	return false;
	    }
	});
});

document.getElementById('submitMandate').addEventListener('click', function(event) {
    var form = document.getElementById('mandateForm');
    if (!form.checkValidity()) {
        event.preventDefault(); // Prevent form submission if not all mandatory fields are filled
        // You can also display an error message or highlight the mandatory fields here
        alert('Please fill in all mandatory fields.');
    }
});

</script>
<script>
    function valCreditorAccno(element) {
		var creditor_acc_no = document.getElementById("loanAcNo");
    	var creditor_acc_error = document.getElementById("creditor_acc_error");
      if (element.value == "") {
        creditor_acc_error.style.display="block";
		creditor_acc_no.style.border="1px solid red";
		return false;
      }
	  if (element.value.length != 16) {
	  creditor_acc_error.style.display="block";
	  creditor_acc_no.style.border="1px solid red";
	  return false;
      }
      else if(element.value.length == 16){
      	creditor_acc_error.style.display="none";
		creditor_acc_no.style.border="none";
		return true;
      }
    }
  </script> 
</head>

<body class="mandate_page">

  <!-- nav for desktop -->
  <div class="container1 statementWrapper">
    <div class="top-bar">
     <img src="img/cedge-logo.png" style="height: 45px;width: 132px;margin-top: 10px;margin-left: 10px;">
    </div>
    <div class="logo-top">
      <div class="Logo"></div>
    </div>
  </div>
  <!--- Navbar Code End -->

  <section class="main-section">
    <form id="enachForm" name="enachForm" th:action="@{/SaveCustData}" th:object="${CustDetails}" method="post" onsubmit="alert('Form Submitted');">
		<div class="container">
      <div class="row">

        <div class="col-lg-12 col-md-12 detail-col">
          <h3>Customer Information</h3>

          <div class="form_div row">
          	<!-- <p id="errorMessage" style="display:none" class="error">Loan Account Number does not match with our records.</p> -->
          	<p id="errorMessage" style="display:none" class="error">Loan Number / Loan Amount / Collection Amount does not match with our records.</p>
			<p id="errorMessage1" style="display:none" class="error">Currently we are unable to process your request.</p>
			
            <div class="form-group col-lg-6 col-md-12 error_input loanno">
              <label for="account_no" class="label-text error_input">Creditor Account Number*</label>
              <div class="input-div">
				<input id="loanAcNo" name="loanAcNo" th:field="*{creditor_Number}" class="acc" data-validation="required custom" data-validation-error-msg="Enter Valid Account number" type="number" value="" required onkeyup="valCreditorAccno(this)" onchange="valCreditorAccno(this)" />
                <p id="creditor_acc_error" style="display:none;font-size: 12px;color: red;">Please
										enter 16 digits creditor account number</p>
              </div>
            </div>
            <div class="form-group col-lg-6 col-md-12 error_input name">
              <label for="full_n" class="label-text">Full Name*</label>
              <div class="input-div">
				<input id="name" name="name" th:field="*{name}" class="name" type="text" value="" maxlength="50" required/>
				<p class="error_msg" id="name_errMsg" style="display:none">Please enter your Name.</p>
              </div>
            </div>
            <div class="form-group col-lg-6 col-md-12 error_input mobile">
              <label for="mobile" class="label-text">Mobile Number*</label>
              <div class="input-div">
				<input id="mobileNumber" name="mobileNumber" th:field="*{mobile}" class="mobile" type="text" value="" maxlength="10" required/>
				<p class="error_msg" id="mobile_errMsg">Please enter your mobile number.</p>
              </div>
            </div>
            
								
            <div class="form-group col-lg-6 col-md-12 error_input loanAmount">
              <label for="relation" class="label-text">Loan Amount*</label>
              <div class="input-div">
                <input id="loanAmount" name="loanAmount" th:field="*{loan_amt}" type="number" class="rupee" value="" required/>
			  <p class="error_msg" id="la_errMsg">Please enter loan amount.</p>
			  </div>
            </div>
            
          </div>

        
        
 
          <h3 class="margin-top-label">Mandate Information</h3>

          <div class="form_div row">
            <div class="form-group col-lg-6 error_input emiAmt">
              <label for="relation" class="label-text">Collection Amount*</label>
              <div class="input-div">
				<input id="emiAmount" name="emiAmount" th:field="*{collection_amt}" type="text" class="rupee" value="" maxlength="9" required/>
				<p class="error_msg" id="eamt_errMsg">Please enter Collection Amount.</p>
              </div>
            </div>
								
           
 
            <div class="form-group dropdown-form col-lg-6">
              <label for="select_freq" class="label-text">Collection Frequency*</label>
			  

              <div class="md-select freq-select">

                  <label for="ul-id1">
                  <select type="hidden" name ="hidFname" th:field="*{frequency}" id="hidFname" required>
			  <option value="Monthly" selected>Monthly</option>
			  <option value="Quarterly">Quarterly</option>
			  <option value="Yearly">Yearly</option>
			  </select>
                   <!-- <button type="button" id="freqBtn"  class="ng-binding freqName">Select Frequency</button> -->
                  </label>
                  <ul role="listbox" id="ul-id1" class="md-whiteframe-z1" aria-activedescendant="coll-freq" name="ul-id1"></ul>
                    <p class="error_msg" id="freq_errMsg">Please select Collection Frequency.</p>      
                </div>
                    
              </div>
              
								

            <div class="form-group col-lg-6 emiStart" >
              <label for="date_start" class="label-text">Collection First Date*</label>
              <div class="input-div">
				<input id="datepicker_first" name="emiStartDate" th:field="*{coll_first_date}" type="text" class="date_input" value="" required/>
				<p class="error_msg" id="emiStart_errMsg" style="display:none">Please select collection first date.</p> 
              </div>
             
            </div>
            <div class="form-group col-lg-6 emiEnd">
              <label for="date_start" class="label-text">Collection Last Date*</label>
			  <input id="datepicker_last" name="emiEndDate" th:field="*{coll_last_date}" type="text" class="date_input" value="" required/>
			 <p class="error_msg" id="emiend_errMsg" style="display:none">Please select collection last date.</p>
            </div>
          </div>
          <div>
          <center><button type="submit" class="cta authorize_btn margin-top-label deactive" id="submitMandate">Submit Mandate</button></center>
        </div>
      </div>
    </div>
	


   				<input id="productCode" name="productCode" type="hidden" value=""/>
			    <input id="bankName" name="bankName" type="hidden" value=""/>
			    <input id="freqName" name="freqName" type="hidden" value=""/>
			    <input id="emiFrequency" name="emiFrequency" type="hidden" value=""/>
			    <input id="emiType" name="emiType" type="hidden" value=""/>
			    <input id="typeName" name="typeName" type="hidden" value=""/>
			    <input id="paymentType" name="paymentType" type="hidden" value=""/>
			    <input id="acccountType" name="acccountType" type="hidden" value=""/>
    			<input type="hidden" name="salt_id" id="salt_id"/>
				<input type="hidden" name="vid" id="vid"/>
			    <input type="hidden" name="qs" id="qs"/>
    </form>
  </section>
<script>
        const paymentMethod = document.getElementById('hidePaymentType');
        var payment_heading = document.querySelector('payment_heading');
        const aadharInput = document.querySelector('.aadhar-input');
        const debitCardInput = document.querySelector('.debit-card-input');

        paymentMethod.addEventListener('change', function() {
            if (this.value === 'Aadhaar number') {
                aadharInput.style.display="flex";
                debitCardInput.classList.remove('form-group');
                debitCardInput.style.display="none";
                payment_heading.style.display="block";
            } else if (this.value === 'Debit Card') {
                aadharInput.style.display="none";
                debitCardInput.classList.remove('form-group');
                debitCardInput.style.display="flex";
                payment_heading.style.display="block";
            } else{
               	aadharInput.style.display="none";
                debitCardInput.style.display="none";
                payment_heading.style.display="none";
            }
        });
    </script>
  <!-- <footer>
    <img src=" images/enach/footer-image.png" alt="" class="demo-images">
  </footer> -->
  <!-- Optional JavaScript -->
 <!-- older jquery  -->
  <!-- <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script> -->
 
</body>

</html>